MHQ = [["Land_ClutterCutter_large_F",[0,-5,0],0,false,false,false,false,[]],["Sign_Arrow_Green_F",[-1803.37,-253.378,-0.564929],-335.682,false,false,false,false,[]],["Sign_Arrow_F",[-1803.37,-253.378,-0.564929],-335.682,false,false,false,false,[]],["Sign_Arrow_Yellow_F",[-1803.37,-253.378,-0.564929],-335.682,false,false,false,false,[]],["Land_HelipadEmpty_F",[0.353271,-1.85486,-1.53022],-335.682,true,false,false,false,[]],["Land_Stretcher_01_sand_F",[0.268799,-2.59204,-2.02156],-91.2231,false,false,false,false,[]],["Land_Stretcher_01_sand_F",[0.532959,-1.02863,-2.02274],-91.2226,false,false,false,false,[]],["Land_Stretcher_01_sand_F",[0.928955,-4.19342,-2.02103],-91.2235,false,false,false,false,[]],["MedicalGarbage_01_1x1_v2_F",[-0.236328,-1.82489,-1.76981],-335.682,false,false,false,false,[]],["Land_IntravenStand_01_2bags_F",[1.16663,-1.90289,-2.02262],24.3161,false,false,false,false,[]],["Land_TripodScreen_01_large_F",[2.72949,-6.46667,-2.02085],-80.7826,false,false,true,false,[]],["Land_Laptop_device_F",[-1.38879,-6.58466,-1.15523],-103.901,false,true,false,false,[]],["Land_Portable_generator_F",[-2.32483,-1.73682,-2.02105],24.316,false,false,false,false,[]],["Land_PortableLight_double_F",[-1.81714,-0.993042,-1.79225],-29.3421,false,false,false,false,[]],["acre_oe_303",[7.07385,-9.62292,-2.02203],-335.682,false,false,false,false,[]],["C_supplyCrate_F",[-2.58264,-7.60071,-2.01635],-175.218,false,false,false,true,[10,true,true]],["Land_WoodenTable_large_F",[-0.563721,-6.49072,-2.01851],-269.219,false,false,false,false,[]],["Land_CampingChair_V2_F",[-0.0749512,-7.23315,-2.01839],-193.902,false,false,false,false,[]],["Land_CampingChair_V2_F",[-1.07922,-7.46399,-2.01753],-253.899,false,false,false,false,[]],["Land_CampingChair_V2_F",[-0.0460205,-5.73322,-2.01936],-13.8943,false,false,false,false,[]],["Land_CampingChair_V2_F",[-0.987061,-5.78009,-2.01865],1.0712,false,false,false,false,[]],["Land_PaperBox_open_empty_F",[-5.26428,-5.37286,-2.01583],-155.682,false,false,false,false,[]],["ACE_medicalSupplyCrate_advanced",[3.02014,-2.38989,-2.02367],-82.6879,false,false,false,false,[]]];

STATICMHQ = [["Sign_Arrow_F",[-1526.4,-998.217,-1.36057],-360,false,false,false,false,[],0],["Sign_Arrow_Green_F",[-1526.4,-998.217,-1.36057],-360,false,false,false,false,[],0],["Sign_Arrow_Yellow_F",[-1526.4,-998.217,-1.36057],-360,false,false,false,false,[],0],["Land_Portable_generator_F",[0.708862,-10.9086,-1.36132],-0.00320435,false,false,false,false,[],0],["C_supplyCrate_F",[2.38635,-11.4626,-1.36052],-199.537,false,false,false,true,[10,true,true],0],["Land_HBarrier_5_F",[8.12122,-12.4947,-1.36052],-210,false,false,false,false,[],0],["Land_HBarrier_5_F",[3.24622,-13.7449,-1.36052],-180,false,false,false,false,[],0],["Land_HBarrier_5_F",[-1.00378,-11.9949,-1.36052],-135,false,false,false,false,[],0],["Land_PaperBox_closed_F",[4.37122,-12.1201,-1.36052],-180,false,false,false,false,[],0],["Land_PaperBox_closed_F",[6.49622,-11.4947,-1.36052],-30,false,false,false,false,[],0],["rhsusf_mrzr4_d",[-2.64368,-7.46301,-1.35896],-108.095,false,false,false,false,[],0],["Land_MetalBarrel_F",[-2.51013,-12.1136,-1.36152],-29.9873,false,false,false,false,[],0],["Land_MetalBarrel_F",[-3.83606,-10.788,-1.36152],-0.0179138,false,false,false,false,[],0],["Land_MetalBarrel_F",[-3.12866,-11.4949,-1.36152],-119.997,false,false,false,false,[],0],["Land_MetalBarrel_empty_F",[-4.18616,-11.76,-1.36052],-165,false,false,false,false,[],0],["Land_HelipadEmpty_F",[0.736328,-6.16559,-1.36052],-360,false,false,false,false,[],1],["Land_HelipadEmpty_F",[7.59204,-3.75635,-1.10341],-360,true,false,false,false,[],0],["Land_Stretcher_01_sand_F",[9.07996,-5.6499,-1.36052],-115.541,false,false,false,false,[],0],["Land_Stretcher_01_sand_F",[7.41577,-2.92896,-1.36052],-115.541,false,false,false,false,[],0],["Land_Stretcher_01_sand_F",[7.81885,-4.46246,-1.36052],-115.541,false,false,false,false,[],0],["MedicalGarbage_01_1x1_v2_F",[7.04248,-3.97162,-1.3434],-360,false,false,false,false,[],0],["Land_IntravenStand_01_2bags_F",[8.35327,-3.46484,-1.36048],-0.00115967,false,false,false,false,[],0],["Land_WeldingTrolley_01_F",[-0.186646,-3.75781,-1.36052],-0.000488281,false,false,false,false,[],0],["Land_Laptop_device_F",[7.75952,2.26843,-0.549487],-206.822,false,true,false,false,[],0],["Land_HBarrier_5_F",[-4.50378,3.50525,-1.36052],-90,false,false,false,false,[],0],["Land_HBarrier_5_F",[-4.50378,-1.99475,-1.36052],-90,false,false,false,false,[],0],["Land_HBarrier_5_F",[8.12122,10.2551,-1.36052],-180,false,false,false,false,[],0],["Land_HBarrier_5_F",[2.87122,9.62988,-1.36052],-15,false,false,false,false,[],0],["Land_ToiletBox_F",[5.48901,8.12854,-1.36296],-0.065094,false,false,false,false,[],0],["Land_ClutterCutter_large_F",[2.66382,-4.14056,-1.36052],-360,false,false,false,false,[],0],["Land_PaperBox_open_empty_F",[-2.51489,0.92749,-1.36052],-180,false,false,false,false,[],0],["ACE_medicalSupplyCrate_advanced",[6.1626,-1.35046,-1.36052],-107.004,false,false,false,false,[],0],["Land_WaterTank_F",[3.39282,8.16156,-1.36149],-14.996,false,false,false,false,[],0],["Land_Pallets_stack_F",[-6.27209,-1.99896,-1.36146],-165.267,false,false,false,false,[],0],["Land_CampingChair_V1_F",[6.1405,1.66949,-1.35742],-165.037,false,false,false,false,[],0],["Land_CampingChair_V1_F",[7.1637,1.13531,-1.35743],-120.053,false,false,false,false,[],0],["Land_CampingChair_V1_F",[8.4292,3.18817,-1.35742],-330.036,false,false,false,false,[],0],["Land_CampingChair_V1_F",[7.64575,3.71014,-1.35742],-315.021,false,false,false,false,[],0],["Land_PaperBox_closed_F",[-2.99243,6.68719,-1.36052],-284.863,false,false,false,false,[],0],["Land_PaperBox_closed_F",[6.87122,8.63,-1.36052],-270,false,false,false,false,[],0],["Land_CamoNetVar_NATO",[8.87122,-1.11975,-1.36052],-270,false,false,false,false,[],0],["Land_CampingTable_F",[7.33887,2.30048,-1.36311],-150.465,false,false,false,false,[],0],["Land_CampingTable_F",[7.74622,3.00507,-1.36311],-330,false,false,false,false,[],0],["MetalBarrel_burning_F",[-2.46216,-0.449524,-1.36052],-345,false,false,false,false,[],0],["Land_Sacks_heap_F",[-4.62878,7.13007,-1.36052],-225,false,false,false,false,[],0],["Fuel_can",[1.14417,-3.79993,-1.36052],-205.463,false,false,false,false,[],0],["Land_DrillAku_F",[-0.783813,-3.45892,-1.3605],-235.048,false,false,false,false,[],0],["Land_BagFenceShort",[11.6217,-6.745,-1.36052],-180,false,false,false,false,[],0],["Land_BagFenceCorner",[12.8712,-6.37,-1.36052],-270,false,false,false,false,[],0],["Land_BagFenceEnd",[10.4957,-6.87006,-1.36052],-195,false,false,false,false,[],0],["Land_TripodScreen_01_large_F",[11.5851,3.09955,-1.36046],-105.104,false,false,true,false,[],0],["Land_PortableLight_double_F",[10.157,0.75769,-1.36052],-273.571,false,false,false,false,[],0],["Land_BagFenceShort",[11.3722,6.38,-1.36052],-180,false,false,false,false,[],0],["Land_BagFenceCorner",[12.7472,6.13013,-1.36052],-360,false,false,false,false,[],0],["Land_BagFenceLong",[13.1212,-1.49475,-1.36052],-270,false,false,false,false,[],0],["Land_BagFenceLong",[13.1212,1.38025,-1.36052],-270,false,false,false,false,[],0],["Land_BagFenceLong",[13.1212,-4.36975,-1.36052],-270,false,false,false,false,[],0],["Land_BagFenceLong",[13.1212,4.25525,-1.36052],-270,false,false,false,false,[],0],["Land_BagFenceEnd",[10.2467,6.25494,-1.36052],-195,false,false,false,false,[],0]];

inGameUISetEventHandler ["Action", "_this call MRH_fnc_RHS_CPBSACTION"];

MRH_fnc_grabObject = {
params ["_pivot","_objectToGrab"];

_relPos = _pivot worldToModel (getPosATL _objectToGrab);
_dir = getDir _pivot;
_objDir = getDir _objectToGrab;
_relDir = (_objDir - _dir);
_className = typeOf _objectToGrab;
_isAceMedicalFacility =_objectToGrab getVariable ["ace_medical_ismedicalfacility",false];
_isMRHSatelliteConsole = _objectToGrab getVariable ["MRH_Sat_isSatelliteConsole",false];
_isMRHSatelliteScreen = _objectToGrab getVariable ["MRH_Sat_isSatelliteScreen",false];
_AmmoCrateParams = _objectToGrab getVariable ["MRH_AmmoCrateParameters",[]];
_isAmmoBox = false;
_isAceRepairFacility = _objectToGrab getVariable ["ace_isrepairfacility",0];
if !(_AmmoCrateParams isEqualTo[]) then {
	_isAmmoBox = true,
	_AmmoCrateParams deleteAt 0;
	};
_return = [_className,_relPos,_reldir,_isAceMedicalFacility,_isMRHSatelliteConsole,_isMRHSatelliteScreen,_isAmmoBox,_AmmoCrateParams,_isAceRepairFacility];
_return
};

MRH_fnc_createObject = {
params ["_pivot","_className","_relPos","_relDir","_isAceMedicalFacility","_isMRHSatelliteConsole","_isMRHSatelliteScreen","_isAmmoBox","_AmmoCrateParams",["_isAceRepairFacility",0]];
_object = _className createVehicle _relPos;
_object setPosATL (_pivot modelToWorld _relPos);
_object setDir ((getDir _pivot) + _reldir);
_object setVectorUp surfaceNormal position _object;
_object setVariable ["ace_medical_ismedicalfacility",_isAceMedicalFacility,true];
_object setVariable ["ace_isrepairfacility",_isAceRepairFacility,true];
if (_isMRHSatelliteConsole) then {[[_object],MRH_fnc_IsSatelliteConsole] remoteExec ["Call",[0,-2] select isDedicated,true]};
if (_isMRHSatelliteScreen) then {[[_object],MRH_fnc_IsSatMonitor] remoteExec ["Call",[0,-2] select isDedicated,true]};
if (_isAmmoBox) then {
	_AmmoCrateParams params ["_number","_unli","_refresh"];
	[[_object,_number,_unli,_refresh],MRH_fnc_AmmoCrate] remoteExec ["Call",[0,-2] select isDedicated,true];
	};
_object	
};

MRH_fnc_storeComp = {
params ["_pivot","_objectsArray"];
_dataOutPut = [];
{
	private _entry = [_pivot,_x] call MRH_fnc_grabObject;
	_dataOutPut pushBackUnique _entry;
} forEach _objectsArray;
_dataOutPut
};

MRH_fnc_spawnComp = {
	params ["_pivot","_dataInput"];

	_compObjects = [];
	{
		/*
		private _class = _x select 0;
		private _relPos = _x select 1;
		private _relDir = _x select 2;
		private _isAceMedicalFacility = _x select 3;
		private _isMRHSatelliteConsole = _x select 4;
		private _isMRHSatelliteScreen = _x select 5;
		private _isAmmoBox = _x select 6;
		private _AmmoCrateParams = _x select 7;
		private _isAceRepairFacility = _x select 8;
		*/
		_x params ["_class","_relPos","_relDir","_isAceMedicalFacility","_isMRHSatelliteConsole","_isMRHSatelliteScreen","_isAmmoBox","_AmmoCrateParams",["_isAceRepairFacility",0]];
		private _object = [_pivot,_class,_relPos,_relDir,_isAceMedicalFacility,_isMRHSatelliteConsole,_isMRHSatelliteScreen,_isAmmoBox,_AmmoCrateParams,_isAceRepairFacility] call MRH_fnc_createObject;
		_compObjects pushBackUnique _object;
	} forEach _dataInput;
	_compObjects
};


MRH_fnc_createComp ={
	params ["_pivot"];
	_allObjects = [];
	_allMission= allMissionObjects "All";
	{
		if (!(isplayer _x) && (_x != _pivot) && (typeOf _x != "logic") && !(_x isKindOf "Man")) then {_allObjects pushBackUnique _x};
	} forEach _allMission;
	_comp = [_pivot,_allObjects] call MRH_fnc_storeComp;
	copyToClipboard str _comp;
};
MRH_fnc_RHS_CPBSACTION = {

	
	0 = _this spawn {
	_vehicle = _this select 0;
	//rhsusf_M1085A1P2_B_WD_Medical_fmtv_usarmy //wood 
	//rhsusf_M1085A1P2_B_D_Medical_fmtv_usarmy //sand
	if ((typeOf _vehicle) != "rhsusf_M1085A1P2_B_WD_Medical_fmtv_usarmy") exitWith {};
	if ((_vehicle animationPhase "platform")!= 1) exitWith {};
	_alreadyCalled = _vehicle getVariable ["MRH_MHQ_actionCalled",false];
	if (_alreadyCalled) exitWith {hint "exited"};
	_vehicle setVariable ["MRH_MHQ_actionCalled",true,true];
	//if (((_vehicle animationPhase "hide_tent") != 1) && ((_vehicle animationPhase "hide_tent") != 0)) exitWith { hint "exited"};

	_doDelete = _vehicle getVariable ["MRH_MHQ_Comp",[]];
	if !(_doDelete isEqualTo []) then {
		{deleteVehicle _x}forEach _doDelete;
		_vehicle setVariable ["MRH_HQ_HQisDeployed",false,true];
		};
	waitUntil {((_vehicle animationPhase "hide_tent") == 0) || ((_vehicle animationPhase "hide_tent") == 1)};
	if ((_vehicle animationPhase "hide_tent") == 0) then {hint "tente repliée"};
	if ((_vehicle animationPhase "hide_tent") == 1) then {
		hint "tente deployée";
		_comp =[_vehicle,mhq] call MRH_fnc_spawnComp;
		_vehicle setVariable ["MRH_MHQ_Comp",_comp,true];
		_vehicle setVariable ["MRH_HQ_HQisDeployed",true,true];

		};
	_vehicle setVariable ["MRH_MHQ_actionCalled",false,true];
	};


};

MRH_fnc_isDeployableContainer =
{
	params ["_HQ"];
	//add deploy action
		_statementDeploy = {
			_HQ = _this select 0; 
			_HQ setVariable ["MRH_HQ_isNotDeploying",true,true];
			_progress = [20,[_HQ],{ 
				_HQ = (_this select 0) select 0;
				_HQ setVariable ["MRH_HQ_isNotDeploying",false,true];
				_comp = [_HQ,STATICMHQ] call MRH_fnc_spawnComp;
				_HQ setVariable ["MRH_HQ_SpawnedComp",_comp,true];
				_HQ setVariable ["MRH_HQ_HQisDeployed",true,true];
				hintC "Poste avancé déployé";
				},{ 
     			//cancel
				 _HQ = (_this select 0) select 0;
				 _HQ setVariable ["MRH_HQ_isNotDeploying",false,true];
				 hintC "Déploiment annulé";
      
      
   				}, 
    		"Déploiement du poste avancé en cours" 
 
 
    			] call ace_common_fnc_progressBar; 
			};
		_loc = "Déployer le QG"; 
		_action =
		["MRH_DeployHQ_action", 
		_loc,
		"",
		_statementDeploy, 
		{_return = false; _HQ = _this select 0;_isDep=  _hq getVariable ["MRH_HQ_HQisDeployed",false];_isDeploying =_HQ getVariable ["MRH_HQ_isNotDeploying",false]; _return = (!(_isDep) && !(_isDeploying));_return},
		{},
		[_HQ],
		[0,0,0], 
		5] call ace_interact_menu_fnc_createAction;
		////
		[_HQ, 0, ["ACE_MainActions"], _action] call ace_interact_menu_fnc_addActionToObject;
	// add repack action 

		_statementRepack = {
			_HQ = _this select 0; 
			_HQ setVariable ["MRH_HQ_isNotDeploying",true,true];
			_progress = [20,[_HQ],{ 
				_HQ = (_this select 0) select 0;
				_HQ setVariable ["MRH_HQ_isNotDeploying",false,true];
				_comp= _HQ getVariable ["MRH_HQ_SpawnedComp",[]];
				{deleteVehicle _x} forEach _comp;
				_HQ setVariable ["MRH_HQ_HQisDeployed",false,true];
				hintC "Poste avancé replié";
				},{ 
     			//cancel
				 _HQ = (_this select 0) select 0;
				 _HQ setVariable ["MRH_HQ_isNotDeploying",false,true];
				 hintC "Repli du PO annulé";
      
      
   				}, 
    		"Repli du poste avancé en cours" 
 
 
    			] call ace_common_fnc_progressBar; 
			};
		_loc = "Repacker le QG"; 
		_actionRP =
		["MRH_RepackHQ_action", 
		_loc,
		"",
		_statementRepack, 
		{_return = false; _HQ = _this select 0;_isDep=  _hq getVariable ["MRH_HQ_HQisDeployed",false];_isDeploying =_HQ getVariable ["MRH_HQ_isNotDeploying",false]; _return = ((_isDep) && !(_isDeploying));_return},
		{},
		[_HQ],
		[0,0,0], 
		5] call ace_interact_menu_fnc_createAction;
		////
		[_HQ, 0, ["ACE_MainActions"], _actionRP] call ace_interact_menu_fnc_addActionToObject;
};
